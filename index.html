<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Across the Stars</title>
    <link rel="icon" type="image/png" href="Img/estrella.webp">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Secular+One&display=swap" rel="stylesheet">
</head>

<body
    style="background-image: url('Img/BG1.png'); background-size: cover; background-repeat: no-repeat; background-attachment: fixed;">

    <!-- Usuario logueado (arriba a la derecha) -->
    <div id="user-profile"
        style="position: absolute; top: 20px; right: 20px; display: none; align-items: center; gap: 10px; background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 50px; backdrop-filter: blur(10px);">
        <img id="user-photo" src="" alt="Avatar"
            style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #fff;">
        <span id="user-name" style="color: #fff; font-size: 16px;">Usuario</span>
    </div>

    <h1 class="title">Across the Stars</h1>

    <div class="menu">
        <a href="modoJ.html" class="btn">Jugar</a>
        <a href="opciones.html" class="btn">Opciones</a>
        <a href="puntuaciones.html" class="btn">Puntuaciones</a>
        <a href="facebook.html" class="btnFacebook">Facebook</a>
        <button id="btn-google" class="btn">Google</button>
    </div>

    <script type="module">
        import { auth, signInWithPopup, signOut, onAuthStateChanged, provider } from './scripts/config/firebase.js';

        const btnGoogle = document.getElementById("btn-google");
        const userProfile = document.getElementById("user-profile");
        const userPhoto = document.getElementById("user-photo");
        const userName = document.getElementById("user-name");

        // Función de Login/Logout
        async function toggleAuth() {
            if (auth.currentUser) {
                // Si ya está logueado → Logout
                await signOut(auth);
                console.log("Sesión cerrada");
            } else {
                // Si no está logueado → Login
                try {
                    const result = await signInWithPopup(auth, provider);
                    console.log("Sesión iniciada:", result.user.email);
                    console.log("Email:", result.user.email);
                    console.log("Nombre:", result.user.displayName);
                    console.log("Foto:", result.user.photoURL);
                } catch (error) {
                    console.error("Error en login:", error.message);
                    alert("Error al iniciar sesión: " + error.message);
                }
            }
        }

        btnGoogle.addEventListener("click", toggleAuth);

        // Escuchar cambios en autenticación
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Usuario logueado
                console.log("Usuario activo:", user.displayName);

                btnGoogle.textContent = "Logout";
                btnGoogle.style.background = "#ef4444";

                userProfile.style.display = "flex";
                userPhoto.src = user.photoURL || "Img/default-avatar.png";
                userName.textContent = user.displayName || "Usuario";

            } else {
                // Usuario NO logueado
                console.log("No hay usuario activo");

                btnGoogle.textContent = "Google";
                btnGoogle.style.background = "";

                userProfile.style.display = "none";
            }
        });
    </script>

    <script src="scripts/api/facebook.js"></script>
</body>
</html>