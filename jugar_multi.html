<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jugar</title>
    <link rel="icon" type="image/png" href="Img/estrella.webp">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Secular+One&display=swap" rel="stylesheet">
</head>
<style>
    .game-area {
  position: relative;
  width: 80vw;
  height: 80vh;
  overflow: hidden;
}
</style>

<body style="background-image: url('Img/BG4.png'); background-size: cover; background-repeat: no-repeat; background-attachment: fixed;">
    <button type="button" id="btn-login">Login</button>
    <button type="button" id="btn-logout">Logout</button>
    <script type="module">
        //hacer npm install firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        import { getAuth, signOut, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
        apiKey: "AIzaSyBxZqkPvJMEb8g7TAU8w7YzOEpKuRkAmI8",
        authDomain: "across-the-stars.firebaseapp.com",
        databaseURL: "https://across-the-stars-default-rtdb.firebaseio.com",
        projectId: "across-the-stars",
        storageBucket: "across-the-stars.firebasestorage.app",
        messagingSenderId: "753694056317",
        appId: "1:753694056317:web:abd659d6022ff42b18b614"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const provider = new GoogleAuthProvider();
        const auth = getAuth(app);
        const db = getDatabase();


        const buttonLogin = document.getElementById('btn-login');
        const buttonLogout = document.getElementById('btn-logout');

        let currentUser;
        async function  login() {
            await signInWithPopup(auth, provider)
            .then((result) => {
                // This gives you a Google Access Token. You can use it to access the Google API.
                const credential = GoogleAuthProvider.credentialFromResult(result);
                const token = credential.accessToken;
                // The signed-in user info.
                currentUser = result.user;
                writeUserData(currentUser.uid, 0, 0);
                console.log("Usuario logueado: ", result.user);
                // IdP data available using getAdditionalUserInfo(result)
                // ...
            }).catch((error) => {
                // Handle Errors here.
                const errorCode = error.code;
                const errorMessage = error.message;
                // The email of the user's account used.
                const email = error.customData?.email || "Correo no disponible";
                // The AuthCredential type that was used.
                const credential = GoogleAuthProvider.credentialFromError(error);
                // ...
            });
        }

        buttonLogin.addEventListener('click', async () => {
            await login();
        });

        buttonLogout.addEventListener('click', async () => {
            await signOut(auth).then(() => {
                // Sign-out successful.
                console.log("Sign-out successful.");
            }).catch((error) => {
                // An error happened.
                console.log("An error happened.");
            });
        });

        //leer
        const starCountRef = ref(db, "jugadores");
            onValue(starCountRef, (snapshot) => {
            const data = snapshot.val();
            console.log(data);
        });
        //escribir
        function writeUserData(userId, positionx, positionz) {
            set(ref(db, 'jugadores/' + userId), {
                x:positionX,
                z:positionZ,
            });
        }



    </script>

    <audio id="bg-music" src="sound/Radio_Portal.mp3" loop autoplay controls></audio> 
    <!-- Área de juego -->
    <div class="game-area"></div>
    
    <!-- HUD / Menú inferior -->
    <div class="hud">
        <div class="hud-item">
            <img src="img/esmeralda.png" alt="Vida" class="hud-icon">
            Vida: <span id="vida">3</span>
        </div>

        <div class="hud-item">
            <img src="img/diamante.png" alt="Potenciador" class="hud-icon">
            <span>x2</span>
        </div>

        <div class="hud-item">
            <img src="img/clock.png" alt="Reloj" class="hud-icon">
            Tiempo: <span id="tiempo">00:00</span>
        </div>

        <div class="hud-item">
            <img src="img/puntu.webp" alt="Puntuacion" class="hud-icon">
            Puntuación: <span id="score">0</span>
        </div>

        <button class="pause-btn" onclick="togglePauseMenu()">⏸️ Pausa</button>
    </div>

    <!-- Mini menú de pausa -->
    <div id="pause-menu" class="pause-menu">
        <button onclick="resumeGame()">Reanudar</button>
        <button onclick="restartGame()">Reiniciar</button>
        <button onclick="exitGame()">Salir</button>
        <button onclick="options()">Opciones</button>
    </div>
    <script type= "module" src="scripts/main.js"></script>
    <script src="scripts/menu.js"></script>
</body>
</html>
